<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/plantilla/plantilla.xhtml">

    <ui:define name="metadata"/>
    <ui:define name="content">

        <h2>Solicitudes</h2>
        <h:outputStylesheet>
            /* Cambia el color de la fila cuando se pasa el mouse */
            .ui-datatable .ui-datatable-data tr.ui-widget-content:hover {
                background-color: #f0f0f0; /* Color de fondo al pasar el mouse */
                color: #000000; /* Color del texto al pasar el mouse */
                text-align: right;
            }
            .ui-datatable .ui-datatable-data tr.ui-widget-content {

                text-align: right;
            }
            .estado-badge {
                padding: 5px;
                border-radius: 3px;
                font-weight: bold;
                text-align: center;
            }
            .ui-state-hover {
                background-color: #f0f0f0 !important; /* Color de fondo al pasar el mouse */
                color: #000000 !important;
            }
            .estado-aprobada {
                background-color: green;
                color: white;
            }

            .estado-rechazada {
                background-color: red;
                color: white;
            }

            .estado-procesada {
                background-color: yellow;
                color: black;
            }

            .estado-registrada {
                background-color: orange;
                color: white;
            }

            .estado-completada {
                background-color: lightblue;
                color: black;
            }


        </h:outputStylesheet>


        <h:form id="formConsultaSolicitud">
            <div class="card">

                <div class="flex justify-content-between">
                    <div>
                        <p:commandButton value="XLSX" icon="pi pi-upload" styleClass="ui-button-help">
                            <p:dataExporter type="xlsxstream" target="tablaSolicitud" fileName="Solicitudes" visibleOnly="true" />
                        </p:commandButton>
                    </div>
                </div>

                <p:dataTable id="tablaSolicitud"
                             paginator="true"
                             paginatorPosition="bottom"
                             rows="5"
                             var="solicitud"
                             rowKey="#{solicitud.id}"
                             rendered="true"
                             widgetVar="dtSolicitudes"
                             selectionMode="single"
                             value="#{solicitudConsultaController.solicitudModel.solicitudes}"
                             filteredValue="#{solicitudConsultaController.solicitudModel.solicitudesFiltradas}"
                             globalFilterFunction="#{solicitudConsultaController.globalFilterFunction}"
                             selection="#{solicitudConsultaController.solicitudModel.seleccionadoSolicitud}"
                             emptyMessage="No hay solicitudes registradas"
                             style="width: 100%; font-size: 10px;">

                    <f:facet name="header">
                        <div class="products-table-header">
                            <span style="font-weight: bold">Solicitudes</span>
                            <span class="filter-container ui-input-icon-left">
                        <i class="pi pi-search" style="color: black;"></i>
                        <p:inputText id="globalFilter" onkeyup="PF('dtSolicitudes').filter()" placeholder="Buscar" />
                    </span>
                        </div>
                    </f:facet>

                    <p:column headerText="Fecha de Registro" sortBy="#{solicitud.fechaRegistro}">
                        <h:outputText value="#{solicitud.fechaRegistroFormatted}" />
                    </p:column>

                    <p:column headerText="Tipo de Solicitud" sortBy="#{solicitud.tipo}">
                        <h:outputText value="#{solicitud.tipo}" />
                    </p:column>

                    <p:column headerText="Cliente" sortBy="#{solicitud.cliente.nombre}">
                        <h:outputText value="#{solicitud.cliente.nombre}" />
                    </p:column>

                    <p:column headerText="DNI del Cliente" sortBy="#{solicitud.cliente.dni}">
                        <h:outputText value="#{solicitud.cliente.dni}" />
                    </p:column>

                    <p:column headerText="Estado" sortBy="#{solicitud.estadoReciente.estado}"  >
                        <h:outputText styleClass="estado-badge #{solicitud.estadoReciente.estado eq 'APROBADA' ? 'estado-aprobada'
                              : solicitud.estadoReciente.estado eq 'RECHAZADA' ? 'estado-rechazada'
                              : solicitud.estadoReciente.estado eq 'PROCESADA' ? 'estado-procesada'
                              : solicitud.estadoReciente.estado eq 'REGISTRADA' ? 'estado-registrada'
                              : solicitud.estadoReciente.estado eq 'COMPLETADA' ? 'estado-completada' : ''}" value="#{solicitud.estadoReciente.estado}" />

                    </p:column>
                    <!-- Opciones de cambio de estado -->
                    <p:column headerText="Opciones" exportable="false">
                        <p:commandButton value="Aprobar" icon="pi pi-check"
                                         rendered="#{solicitud.estadoReciente.estado eq 'REGISTRADA'}"
                                         actionListener="#{solicitudConsultaController.cambiarEstado(solicitud, 'APROBADA')}"
                                         update=":tablaSolicitud :messages" />

                        <p:commandButton value="Rechazar" icon="pi pi-times"
                                         rendered="#{solicitud.estadoReciente.estado eq 'REGISTRADA'}"
                                         actionListener="#{solicitudConsultaController.cambiarEstado(solicitud, 'RECHAZADA')}"
                                         update=":tablaSolicitud :messages" />

                        <p:commandButton value="Procesar" icon="pi pi-cog"
                                         rendered="#{solicitud.estadoReciente.estado eq 'APROBADA'}"
                                         actionListener="#{solicitudConsultaController.cambiarEstado(solicitud, 'PROCESADA')}"
                                         update=":tablaSolicitud :messages" />

                        <p:commandButton value="Completar" icon="pi pi-check"
                                         rendered="#{solicitud.estadoReciente.estado eq 'APROBADA' or solicitud.estadoReciente.estado eq 'PROCESADA'}"
                                         actionListener="#{solicitudConsultaController.cambiarEstado(solicitud, 'COMPLETADA')}"
                                         update=":tablaSolicitud :messages" />
                    </p:column>



                </p:dataTable>

            </div>

        </h:form>




    </ui:define>

</ui:composition>

